<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<dom-module id="uqlibrary-app">
  <template>
    <uqlibrary-scaffold id="uqlScaffold" app-title="UQ Library" enable-search-suggestions="true">
      <h1>Select date and time</h1>

      <iron-pages selected="[[route]]" attr-for-selected="sub-application">

        <div sub-application="home"><h2>Home App....</h2></div>
        <div sub-application="hours"><h2>Hours App....</h2></div>

        <div sub-application="booking">
          <h2>Booking App....</h2>
          <pre>
            TODO: insert something like 'uqlibrary-booking-app'
          </pre>
          <p>
            <uqlibrary-date-selector id="dateSelector"></uqlibrary-date-selector>
          </p>
        </div>

        <div sub-application="borrowing">
          <h2>Borrowing App....</h2>
          <pre>
            TODO: insert something like 'uqlibrary-borrowing-app'
          </pre>
        </div>
        <div sub-application="computers"><h2>Computers App....</h2></div>
        <div sub-application="courses"><h2>Courses App....</h2></div>
        <div sub-application="research"><h2>Research App....</h2></div>
        <div sub-application="printing"><h2>Printing App....</h2></div>
        <div sub-application="masquerade"><h2>Masquerade App....</h2></div>
        <div sub-application="feedback"><h2>Feedback App....</h2></div>
        <div sub-application="askus"><h2>Ask Us App....</h2></div>

      </iron-pages>
    </uqlibrary-scaffold>
  </template>
</dom-module>
<script>


  (function () {
    Polymer({
      is: 'uqlibrary-app',

      properties: {
        route: {
          type: String,
          observer: 'routeChanged'
        }
      },

      ready: function() {
        var that = this;
        var today = new Date();
        today = new Date(today.getFullYear(), today.getMonth(), today.getDate());

        this.$.dateSelector.selectedDate = new Date(today.setHours(0));
        this.$.dateSelector.startDate = new Date(today.setHours(0) - 5 * 24 * 60 * 60 * 1000);
        this.$.dateSelector.endDate = new Date(today.setHours(0) + 5 * 24 * 60 * 60 * 1000);
        this.$.dateSelector.maxSelectionLength = 3;

        this.$.dateSelector.timeslots = this.generateTimeslots(this.$.dateSelector.selectedDate);

        document.addEventListener('uqlibrary-search-input-search-value-changed', function(e) {
          that.$.uqlScaffold.fire('uqlibrary-search-input-search-suggestions-loaded', {data: [ { text: 'suggestion 1 for '+ e.detail.value, url: '#' }, { text: 'suggestion 2' }, { text: 'suggestion 3', url: 'http://google.com' }] })
          console.log('event listener');
        });

        document.addEventListener('uqlibrary-search-input-search-submitted', function(e) {
          console.log('search-submitted ' + e.detail.searchTerm);
        });

      },

      routeChanged: function(newValue, oldValue) {
        console.log('Route changed to ' + newValue + ' from ' + oldValue);
      },

      generateTimeslots: function(date) {

      var timeslots = [];

      for (var i = 0; i < 10; i++) {
        timeslots.push({
          startTime: new Date(date.setHours(i)),
          endTime: new Date(date.setHours(i + 1)),
          selectable: (i !== 7),
          selected: (i < 2)
        });
      }

      return timeslots;
    }
    });
  })();
</script>
