<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<dom-module id="uqlibrary-app">
  <template>

    <uqlibrary-api-account id="apiAccount" on-uqlibrary-api-account-loaded="accountLoaded"></uqlibrary-api-account>

    <uqlibrary-scaffold id="uqlScaffold"
                        app-title="UQ Library"
                        app-menu-file="menu.json"
                        user="{{user}}"
                        enable-search-suggestions="true">
      <h1>Welcome, <span>{{user.name}}</span></h1>

      <iron-pages selected="[[route]]" attr-for-selected="sub-application">

        <div sub-application="home">
          <uqlibrary-hours-element id="hoursElement"></uqlibrary-hours-element>
        </div>
        <div sub-application="hours"><h2>Hours App....</h2></div>

        <div sub-application="booking">
          <h2>Booking App....</h2>
          <pre>
            TODO: insert something like 'uqlibrary-booking-app'
          </pre>
        </div>

        <div sub-application="borrowing">
          <h2>Borrowing App....</h2>
          <pre>
            <a href="/askus">go home</a>
            TODO: insert something like 'uqlibrary-borrowing-app'
          </pre>
        </div>
        <div sub-application="computers"><h2>Computers App....</h2></div>
        <div sub-application="courses"><h2>Courses App....</h2></div>
        <div sub-application="research"><h2>Research App....</h2></div>
        <div sub-application="printing"><h2>Printing App....</h2></div>
        <div sub-application="masquerade"><h2>Masquerade App....</h2></div>
        <div sub-application="feedback"><h2>Feedback App....</h2></div>
        <div sub-application="askus"><h2>Ask Us App....</h2></div>

      </iron-pages>

    </uqlibrary-scaffold>
  </template>
</dom-module>
<script>


  (function () {
    Polymer({
      is: 'uqlibrary-app',

      properties: {
        user: {
          type: Object,
          observer: 'userChanged'
        },
        route: {
          type: String,
          observer: 'routeChanged'
        }
      },

      accountLoaded: function(e){
        if (e.detail.hasSession) {
          this.user = e.detail;
        }
      },

      userChanged: function() {
        console.log('user updated');
      },

      ready: function() {
        var that = this;

        this.$.apiAccount.get();

        document.addEventListener('uqlibrary-search-input-search-value-changed', function(e) {
          that.$.uqlScaffold.fire('uqlibrary-search-input-search-suggestions-loaded', {data: [ { text: 'suggestion 1 for '+ e.detail.value, url: '#' }, { text: 'suggestion 2' }, { text: 'suggestion 3', url: 'http://google.com' }] });
          console.log('event listener');
        });

        document.addEventListener('uqlibrary-search-input-search-submitted', function(e) {
          console.log('search-submitted ' + e.detail.searchTerm);
        });

        this.$.uqlScaffold.addEventListener('menu-selected', function(event) {
          console.log('menu-selected');
          console.log(event.detail);
        });
      },

      routeChanged: function(newValue, oldValue) {
        console.log('Route changed to ' + newValue + ' from ' + oldValue);
      }

    });
  })();
</script>
